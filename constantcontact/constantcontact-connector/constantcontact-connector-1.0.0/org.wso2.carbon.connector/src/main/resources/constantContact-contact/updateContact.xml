<template name="updateContact" xmlns="http://ws.apache.org/ns/synapse">
	<parameter name="contactId" description="The unique identifier of the contact." />
	<parameter name="emailAddresses" description="The array of email addresses for the contact." />
	<parameter name="lists" description="The Array of contacts lists to be a member of." />
	<parameter name="actionBy" description="The parameter identifying who originated the request." />
	<parameter name="addresses" description="The array of mail addresses for the contact." />
	<parameter name="cellPhone" description="The cell phone number." />
	<parameter name="companyName" description="The company name of the contact." />
	<parameter name="customFields" description="The custom fields to be set for the contact." />
	<parameter name="fax" description="The fax number of the contact." />
	<parameter name="firstName" description="The first name of the contact." />
	<parameter name="middleName" description="The middle name of the contact." />
	<parameter name="lastName" description="The last name of the contact." />
	<parameter name="homePhone" description="The contact's home phone number." />
	<parameter name="jobTitle" description="The job title of the contact." />
	<parameter name="notes" description="The note associated with the contact." />
	<parameter name="prefixName" description="The salutation of the contact." />
	<parameter name="workPhone" description="The contact's work phone number." />
	
	<sequence>
		<property name="uri.var.contactId" expression="$func:contactId" />
		<property name="uri.var.emailAddresses" expression="$func:emailAddresses" />
		<property name="uri.var.lists" expression="$func:lists" />
		<property name="uri.var.actionBy" expression="$func:actionBy" />
		<property name="uri.var.addresses" expression="$func:addresses" />
		<property name="uri.var.cellPhone" expression="$func:cellPhone" />
		<property name="uri.var.companyName" expression="$func:companyName" />
		<property name="uri.var.customFields" expression="$func:customFields" />
		<property name="uri.var.fax" expression="$func:fax" />
		<property name="uri.var.firstName" expression="$func:firstName" />
		<property name="uri.var.middleName" expression="$func:middleName" />
		<property name="uri.var.lastName" expression="$func:lastName" />
		<property name="uri.var.homePhone" expression="$func:homePhone" />
		<property name="uri.var.jobTitle" expression="$func:jobTitle" />
		<property name="uri.var.notes" expression="$func:notes" />
		<property name="uri.var.prefixName" expression="$func:prefixName" />
		<property name="uri.var.workPhone" expression="$func:workPhone" />
		<property name="uri.var.queryParams" value="" />
		
		<!-- Some optional parameters added as mandatory since they don't work as in documentation. -->
		<payloadFactory media-type="json">
			<format>
				{
					"first_name":"$1",
					"middle_name":"$2",
					"last_name":"$3",
					"prefix_name":"$4",
					"company_name":"$5",
					"job_title":"$6"
				}
			</format>
			<args>
				<arg expression="get-property('uri.var.firstName')" />
				<arg expression="get-property('uri.var.middleName')" />
				<arg expression="get-property('uri.var.lastName')" />
				<arg expression="get-property('uri.var.prefixName')" />
				<arg expression="get-property('uri.var.companyName')" />
				<arg expression="get-property('uri.var.jobTitle')" />
			</args>
		</payloadFactory>
		
		<script language="js">
			<![CDATA[
				
				payload = mc.getPayloadJSON();
				
				// Setting mandatory parameters.
				var emailAddresses = mc.getProperty('uri.var.emailAddresses');
				var lists = mc.getProperty('uri.var.lists');
				
				if (emailAddresses != null && emailAddresses != "") {
	            	payload.email_addresses = eval("("+emailAddresses+")");
	            } else {
	            	payload.email_addresses = "";
	            }
	            
	            if (lists != null && lists != "") {
	            	payload.lists = eval("("+lists+")");
	            } else {
	            	payload.lists = "";
	            }

				// Setting optional parameters.
				var actionBy = mc.getProperty('uri.var.actionBy');
				var addresses = mc.getProperty('uri.var.addresses');
				var cellPhone = mc.getProperty('uri.var.cellPhone');
				var customFields = mc.getProperty('uri.var.customFields');
				var fax = mc.getProperty('uri.var.fax');
				var homePhone = mc.getProperty('uri.var.homePhone');
				var notes = mc.getProperty('uri.var.notes');
				var workPhone = mc.getProperty('uri.var.workPhone');
				var queryParams = mc.getProperty('uri.var.queryParams');
												
				if (actionBy != null && actionBy != "") {
	            	queryParams = '&action_by=' + actionBy;
	            	mc.setProperty('uri.var.queryParams', queryParams);
	            }
	            
	            if (addresses != null && addresses != "") {
	            	payload.addresses = eval("("+addresses+")");
	            }
	            
	            if (cellPhone != null && cellPhone != "") {
	            	payload.cell_phone = cellPhone;
	            }
	            
	            if (customFields != null && customFields != "") {
	            	payload.custom_fields = eval("("+customFields+")");
	            }
	            
	            if (fax != null && fax != "") {
	            	payload.fax = fax;
	            }
	            
	            if (homePhone != null && homePhone != "") {
	            	payload.home_phone = homePhone;
	            }
	            
	            if (notes != null && notes != "") {
	            	payload.notes = eval("("+notes+")");
	            }
	            
	            if (workPhone != null && workPhone != "") {
	            	payload.work_phone = workPhone;
	            }
	            
				mc.setPayloadJSON(payload);		
						
			]]>
		</script>
		
		<call>
			<endpoint>
				<http method="put" 
					uri-template="{uri.var.apiUrl}/contacts/{uri.var.contactId}{uri.var.apiKey}{uri.var.queryParams}" />
			</endpoint>
		</call>

		<!-- Remove custom Headers from the API Response -->
		<header name="X-Mashery-Error-Code" action="remove" scope="transport" />
		<header name="X-Mashery-Responder" action="remove" scope="transport" />
		<header name="X-Powered-By" action="remove" scope="transport" />
		<header name="Location" action="remove" scope="transport" />
		
	</sequence>
</template>